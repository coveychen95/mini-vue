{"version":3,"file":"mini-vue.esm.js","sources":["../src/shared/shapeFlag.ts","../src/runtime-core/createVNode.ts","../src/runtime-core/h.ts","../src/runtime-core/render-api/index.ts","../src/runtime-core/renderer.ts","../src/runtime-core/createApp.ts"],"sourcesContent":["// 组件的类型\nexport const enum ShapeFlags {\n  // 最后要渲染的 element 类型\n  ELEMENT = 1,\n  // 组件类型\n  STATEFUL_COMPONENT = 1 << 2,\n  // vnode 的 children 为 string 类型\n  TEXT_CHILDREN = 1 << 3,\n  // vnode 的 children 为数组类型\n  ARRAY_CHILDREN = 1 << 4,\n}","import { ShapeFlags } from \"../shared\";\n\nexport function createVNode(\n  type: any,\n  props?: any,\n  children?: string | Array<any>\n) {\n  const vnode = {\n    el: null,\n    component: null,\n    type,\n    props,\n    children,\n    shapeFlag: getShapeFlag(type)\n  }\n\n  // 基于 children 再次设置 shapeFlag\n  if (Array.isArray(children)) {\n    vnode.shapeFlag |= ShapeFlags.ARRAY_CHILDREN\n  } else if (typeof children === 'string'){\n    vnode.shapeFlag |= ShapeFlags.TEXT_CHILDREN\n  }\n  \n  return vnode\n}\n\nfunction getShapeFlag(type: any) {\n  return  typeof type === \"string\"\n    ? ShapeFlags.ELEMENT\n    : ShapeFlags.STATEFUL_COMPONENT\n}","import { createVNode } from './createVNode'\n\nexport function h(\n  type: string,\n  props: any,\n  children: string | Array<any>\n) {\n  return createVNode(type, props, children)\n}\n","// TODO:\n// 源码里面这些接口是由 runtime-dom 来实现\n// 这里先简单实现\n// 后面也修改成和源码一样的实现\n\nexport function hostCreateElement(type) {\n  console.log(\"hostCreateElement -> type: \", type);\n  const element = document.createElement(type);\n  return element;\n}\n\nexport function hostSetElementText(el, text) {\n  console.log('hostSetElementText -> el, text: ', el, text)\n  el.innerText = text\n}\n\nexport function hostPatchProp() {}\n\nexport function hostInsert() {}\n\n","import { h } from '.'\nimport { ShapeFlags } from '../shared'\nimport { createComponentInstence } from './component'\nimport {\n  hostCreateElement, hostSetElementText\n} from './render-api'\n\nexport function render(vnode, container) {\n  console.log('调用 patch')\n  patch(null, vnode, container)\n}\n\nfunction patch(n1, n2, container) {\n  // 基于 n2 的类型判断\n  // 因为 n2 是新的 vnode\n  const { type, shapeFlag } = n2\n  console.log('type: ', type);\n  switch(type) {\n    \n    case 'text':\n      // TODO:\n      // ...\n      break\n    default:\n      // 这里基于 shapeFlag 处理\n      if (shapeFlag & ShapeFlags.ELEMENT) {\n        console.log('处理 element')\n        processElement(n1, n2, container);\n      } else if (shapeFlag & ShapeFlags.STATEFUL_COMPONENT) {\n        console.log('处理 component');\n        processComponent(n1, n2, container);\n      }\n  }\n}\n\nfunction processElement(n1, n2, container) {\n  if (!n1) {\n    mountElement(n2, container)\n  } else {\n    // TODO:\n    // updateElement()\n  }\n}\n\n\nfunction mountElement(vnode, container) {\n  const { ShapeFlag, props } = vnode\n  // 1.先创建 element\n  // 基于可拓展的渲染 api\n  const el = (vnode.el = hostCreateElement(vnode.type))\n  // 支持单子组件和多子组件的创建\n  if (ShapeFlag & ShapeFlags.TEXT_CHILDREN) {\n    // 举个例子\n    // render() {\n    //   return h('div', {}, 'text')\n    // }\n    // 这里的 children 就是 text ，直接渲染即可\n    console.log(`处理文本：${vnode.children}`)\n    hostSetElementText(el, vnode.children)\n  }\n\n}\n\n\n\n\nfunction processComponent(n1, n2, container) {}\n","import { render } from './renderer'\nimport { createVNode } from './createVNode'\n\n// TODO:\n// createApp\n// 在 vue3 里面 createApp 是属于 renderer 对象的\n// 而 renderer 对象需要创建\n// 这里我们暂时不实现\n\nexport const createApp = (rootComponent) => {\n  const app = {\n    _component: rootComponent,\n    _container: null,\n    mount(rootContainer) {\n      console.log('基于根组件创建 vnode')\n      const vnode = createVNode(rootComponent);\n      app._container = rootContainer\n      console.log('调用 render , 基于 vnode 进行开箱')\n      render(vnode, rootContainer)\n      return app\n    }\n  }\n\n  return app\n}"],"names":[],"mappings":"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"}